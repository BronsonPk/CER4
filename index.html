<!DOCTYPE html>
<html>
<head>
    <title>Paris Olympic Opening Ceremony Transportation Planner</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Paris Olympic Opening Ceremony Transportation Planner</h1>
        <div class="form-group">
            <label for="hotel-select">Select Hotel:</label>
            <select class="form-control" id="hotel-select"></select>
        </div>
        <div class="form-group">
            <label for="venue-select">Select Venue:</label>
            <select class="form-control" id="venue-select"></select>
        </div>
        <button class="btn btn-primary" id="calculate-route-btn">Calculate Best Route</button>
        <div id="map">
            <iframe src="https://www.google.com/maps/d/embed?mid=1mcw__OCuW21w_yuUoRQxjC1LrP3vVr0" width="100%" height="400"></iframe>
        </div>
        <div id="directions-panel"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Venue data
        const venues = [
            { name: "Palais & Palais Plus", coordinates: [2.3127975610256195, 48.86601750126548] },
            { name: "Maison Salon 24", coordinates: [2.3129123449325562, 48.86610090698182] },
            { name: "Alma Bridge 360", coordinates: [2.3016312718391418, 48.86329523104615] },
            { name: "Concorde Bridge 360", coordinates: [2.3211893439292908, 48.86496427370399] },
            { name: "Terrace (Ex Girafe) + Suite (Ex Suite Girafe)", coordinates: [2.296314984560013, 48.863325949218386] },
            { name: "Musee de l'Homme", coordinates: [2.2948312237739563, 48.861753092526364] },
            { name: "Iena (Ducasse sur Seine)", coordinates: [2.2935746908187866, 48.86406198532917] },
            { name: "Alma (Mlle Mouche)", coordinates: [2.3016606569290093, 48.86424736451839] },
            { name: "Invalides 3 (Fluctuart)", coordinates: [2.30677276849747, 48.85991044711709] },
            { name: "Invalides 2 (Riviera Fuga)", coordinates: [2.3090425133705146, 48.85907930975199] },
            { name: "Invalides 1 (Le Flow)", coordinates: [2.3112833499908447, 48.85842274413223] },
            { name: "Orsay 2 (Concorde Atlantique)", coordinates: [2.324639558792114, 48.86197275619274] },
            { name: "Orsay 1 (Ex Melba)", coordinates: [2.325425148010254, 48.86106400759027] },
            { name: "The Deck", coordinates: [2.3205491900444036, 48.86420700841899] },
            { name: "Grandstand", coordinates: [2.3181134462356567, 48.86320862137534] },
            { name: "Grand Stand", coordinates: [2.3180657625198364, 48.86329523104615] }
        ];

        // PSA data
        const psas = [
            { name: "PSA Av. Dutuit", coordinates: [2.2955846786499023, 48.86234235501969] },
            { name: "PSA Rue A. Briand", coordinates: [2.2995805740356445, 48.86426989700589] },
            { name: "PSA Rue Solferino", coordinates: [2.3253345489501953, 48.860877851196144] },
            { name: "PSA Av Rapp", coordinates: [2.2990512847900386, 48.85829404702246] },
            { name: "PSA Av George V", coordinates: [2.3008507490158085, 48.865935207521114] },
            { name: "PSA Rue Galiera", coordinates: [2.2970104217529297, 48.86568426147181] },
            { name: "PSA Bvd de La Tour-Maubourg", coordinates: [2.3076754808425903, 48.860023670614175] },
            { name: "PSA Av. F Roosevelt", coordinates: [2.298855781555176, 48.866836382493114] },
            { name: "PSA Kleber", coordinates: [2.2930371761322017, 48.86979280169106] },
            { name: "PSA TROCADERO", coordinates: [2.288243770599365, 48.86411712832395] },
            { name: "VSA TROCADERO", coordinates: [2.2903251647949214, 48.864340857790155] }
        ];
   let map;
        let hotels = [];
        let hotelMarker;
        let venueMarker;
        let directionsService;
        let directionsRenderer;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 48.8566, lng: 2.3522 },
                zoom: 12
            });
    displaySecurityPerimeter();
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
            directionsRenderer.setPanel(document.getElementById('directions-panel'));

            fetch('https://sheets.googleapis.com/v4/spreadsheets/1fktkp6Osgs08qbYgKorEaZZxdDLq-0LRN3BMw7j_4kQ/values/Hotels!B2:C51?key=AIzaSyBjlGkxN5JMqjBQn0Tb0HY-3hG8ACkITuM')
                .then(response => response.json())
                .then(data => {
                    hotels = data.values.map(row => ({
                        name: row[0],
                        address: row[1]
                    }));
                    console.log('Hotels:', hotels);

                    populateHotelDropdown();
                    populateVenueDropdown();
                })
                .catch(error => {
                    console.error('Error fetching hotel data:', error);
                });
        }

function populateHotelDropdown() {
    const hotelSelect = document.getElementById('hotel-select');

    // Add a default option
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Select your hotel';
    hotelSelect.appendChild(defaultOption);

    hotels.forEach(hotel => {
        const option = document.createElement('option');
        option.value = hotel.address;
        option.textContent = hotel.name;
        hotelSelect.appendChild(option);
    });

    hotelSelect.addEventListener('change', showHotelMarker);
}

function populateVenueDropdown() {
    const venueSelect = document.getElementById('venue-select');

    // Add a default option
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Select your venue';
    venueSelect.appendChild(defaultOption);

    venues.forEach(venue => {
        const option = document.createElement('option');
        option.value = venue.coordinates.join(',');
        option.textContent = venue.name;
        venueSelect.appendChild(option);
    });

    venueSelect.addEventListener('change', showVenueMarker);
}

        function showHotelMarker() {
            const selectedHotel = document.getElementById('hotel-select').value;
            const hotelName = document.getElementById('hotel-select').options[document.getElementById('hotel-select').selectedIndex].text;
            if (selectedHotel) {
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ address: selectedHotel }, function(results, status) {
                    if (status === 'OK') {
                        const location = results[0].geometry.location;
                        if (hotelMarker) {
                            hotelMarker.setMap(null);
                        }
                        hotelMarker = new google.maps.Marker({
                            map: map,
                            position: location,
                            title: hotelName
                        });
                        map.setCenter(location);
                        map.setZoom(14);
                    } else {
                        console.error('Geocode was not successful for the following reason:', status);
                    }
                });
            }
        }

        function showVenueMarker() {
            const selectedVenueCoordinates = document.getElementById('venue-select').value.split(',');
            const venueName = document.getElementById('venue-select').options[document.getElementById('venue-select').selectedIndex].text;

            if (selectedVenueCoordinates.length === 2) {
                const venueLocation = new google.maps.LatLng(parseFloat(selectedVenueCoordinates[1]), parseFloat(selectedVenueCoordinates[0]));

                if (venueMarker) {
                    venueMarker.setMap(null);
                }

                venueMarker = new google.maps.Marker({
                    map: map,
                    position: venueLocation,
                    title: venueName
                });

                map.setCenter(venueLocation);
                map.setZoom(14);
            }
        }

        function findNearestPSA(location) {
            let nearestPSA = null;
            let minDistance = Infinity;

            psas.forEach(psa => {
                const distance = google.maps.geometry.spherical.computeDistanceBetween(
                    new google.maps.LatLng(location),
                    new google.maps.LatLng(psa.coordinates[1], psa.coordinates[0])
                );

                if (distance < minDistance) {
                    minDistance = distance;
                    nearestPSA = psa;
                }
            });

            return nearestPSA;
        }

function calculateRoute() {
    const selectedHotel = document.getElementById('hotel-select').value;
    const selectedVenueCoordinates = document.getElementById('venue-select').value.split(',');

    if (selectedHotel && selectedVenueCoordinates.length === 2) {
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: selectedHotel }, function(hotelResults, hotelStatus) {
            if (hotelStatus === 'OK') {
                const hotelLocation = hotelResults[0].geometry.location;
                const venueLocation = new google.maps.LatLng(parseFloat(selectedVenueCoordinates[1]), parseFloat(selectedVenueCoordinates[0]));
                const nearestPSA = findNearestPSA(venueLocation);

                if (nearestPSA) {
                    const psaLocation = new google.maps.LatLng(nearestPSA.coordinates[1], nearestPSA.coordinates[0]);

                    const request = {
                        origin: hotelLocation,
                        destination: venueLocation,
                        waypoints: [{ location: psaLocation, stopover: true }],
                        travelMode: 'DRIVING',
                        provideRouteAlternatives: false,
                        optimizeWaypoints: false
                    };

                    directionsService.route(request, function(result, status) {
                        if (status === 'OK') {
                            // Clear previous markers and directions
                            directionsRenderer.setMap(null);
                            directionsRenderer.setPanel(null);

                            // Create custom markers for hotel, PSA, and venue
                            const hotelMarker = new google.maps.Marker({
                                position: hotelLocation,
                                map: map,
                                label: 'Hotel'
                            });

                            const psaMarker = new google.maps.Marker({
                                position: psaLocation,
                                map: map,
                                label: 'Closest PSA'
                            });

                            const venueMarker = new google.maps.Marker({
                                position: venueLocation,
                                map: map,
                                label: 'CER Venue'
                            });

                            // Set the directions renderer with the new result
                            directionsRenderer.setMap(map);
                            directionsRenderer.setPanel(document.getElementById('directions-panel'));
                            directionsRenderer.setDirections(result);
                        } else {
                            console.error('Directions request failed due to ' + status);
                        }
                    });
                } else {
                    console.error('Nearest PSA not found');
                }
            } else {
                console.error('Geocode was not successful for the following reason:', hotelStatus);
            }
        });
    }
}
        function displaySecurityPerimeter() {
    map.data.addGeoJson(securityPerimeterGeoJson);
    map.data.setStyle({
        fillColor: 'red',
        fillOpacity: 0.2,
        strokeColor: 'red',
        strokeWeight: 2
    });
}

        document.getElementById('calculate-route-btn').addEventListener('click', calculateRoute);
    </script>
    <script src="securityPerimeter.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjlGkxN5JMqjBQn0Tb0HY-3hG8ACkITuM&libraries=geometry&callback=initMap" async defer></script>
</body>
</html>     
